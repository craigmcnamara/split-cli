#!/usr/bin/env ruby

require "bundler/setup"
require "split/cli"
require 'pry'

require 'optparse'

options = {}

parser = OptionParser.new do |opts|
  opts.banner = "Usage: split-cli [ab_test|finished] session_id experiment_name"
end

parser.parse!

if ARGV.empty?
  puts parser
  exit 1
else
  args = ARGV.dup
  command = args.shift.to_sym

  begin
    raise(Split::Cli::CommandError, "No session_id") unless session_id = args.shift
    result = Split::Cli::Session.new(session_id).method(command).call(*args)
    puts result if result.is_a?(String)
  rescue Split::Cli::CommandError => e
    puts e.message 
    exit 1
  rescue NameError => e
    puts 'Invalid split-cli operation'
    exit 1
  end
end
